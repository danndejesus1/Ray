<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarGo User Dashboard</title>
    <meta name="theme-color" content="#34B2DF">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Outfit:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="navbar bg-white shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <a href="../../index.html" class="text-2xl font-bold text-gray-800">CarGo</a>
                    <span class="text-gray-500">|</span>
                    <span class="text-lg font-semibold text-blue-600">My Dashboard</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="user-welcome" class="text-gray-600">Welcome back!</span>
                    <button id="logout-btn" class="btn btn-secondary">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex">
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-lg min-h-screen">
            <div class="p-6">
                <nav class="space-y-2">
                    <a href="#dashboard" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg bg-blue-50 text-blue-600 font-medium">
                        <span>üè†</span>
                        <span>Dashboard</span>
                    </a>
                    <a href="#search" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50">
                        <span>üîç</span>
                        <span>Search Vehicles</span>
                    </a>
                    <a href="#bookings" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50">
                        <span>üìã</span>
                        <span>My Bookings</span>
                    </a>
                    <a href="#history" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50">
                        <span>üìú</span>
                        <span>Booking History</span>
                    </a>
                    <a href="#profile" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50">
                        <span>üë§</span>
                        <span>Profile</span>
                    </a>
                    <a href="#reports" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50">
                        <span>üìä</span>
                        <span>Reports</span>
                    </a>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Dashboard</h1>
                
                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="stat-card">
                        <div class="stat-value" id="total-bookings">0</div>
                        <div class="stat-label">Total Bookings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="active-bookings">0</div>
                        <div class="stat-label">Active Bookings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-spent">‚Ç±0</div>
                        <div class="stat-label">Total Spent</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card mb-8">
                    <h2 class="text-xl font-semibold mb-4">Quick Actions</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button onclick="userDashboard.showSection('search')" class="btn btn-primary text-center">
                            üîç Search Vehicles
                        </button>
                        <button onclick="userDashboard.showSection('bookings')" class="btn btn-secondary text-center">
                            üìã View Bookings
                        </button>
                        <button onclick="userDashboard.showSection('profile')" class="btn btn-secondary text-center">
                            üë§ Edit Profile
                        </button>
                        <button onclick="userDashboard.generateTransactionReport()" class="btn btn-secondary text-center">
                            üìä Print Transactions
                        </button>
                    </div>
                </div>

                <!-- Recent Bookings -->
                <div class="card">
                    <h2 class="text-xl font-semibold mb-4">Recent Bookings</h2>
                    <div id="recent-bookings" class="space-y-4">
                        <!-- Recent bookings will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Search Vehicles Section -->
            <div id="search-section" class="section hidden">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Search Vehicles</h1>
                
                <!-- Vehicle Filters -->
                <div class="card mb-6">
                    <h3 class="text-lg font-semibold mb-4">Filter Vehicles</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label class="form-label">Brand</label>
                            <select id="user-brand-filter" class="form-input">
                                <option value="">All Brands</option>
                                <option value="Toyota">Toyota</option>
                                <option value="Honda">Honda</option>
                                <option value="Mitsubishi">Mitsubishi</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Vehicle Type</label>
                            <select id="user-type-filter" class="form-input">
                                <option value="">All Types</option>
                                <option value="Sedan">Sedan</option>
                                <option value="SUV">SUV</option>
                                <option value="Van">Van</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Fuel Type</label>
                            <select id="user-fuel-filter" class="form-input">
                                <option value="">All Fuel Types</option>
                                <option value="Petrol">Petrol</option>
                                <option value="Diesel">Diesel</option>
                                <option value="Hybrid">Hybrid</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Seating Capacity</label>
                            <select id="user-capacity-filter" class="form-input">
                                <option value="">Any Capacity</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Pickup Date</label>
                            <input type="text" id="user-pickup-date" class="flatpickr form-input" placeholder="Select date">
                        </div>
                        <div>
                            <label class="form-label">Return Date</label>
                            <input type="text" id="user-return-date" class="flatpickr form-input" placeholder="Select date">
                        </div>
                        <div>
                            <label class="form-label">Price Range</label>
                            <select id="user-price-filter" class="form-input">
                                <option value="">Any Price</option>
                                <option value="0-1500">‚Ç±0 - ‚Ç±1,500</option>
                                <option value="1500-2500">‚Ç±1,500 - ‚Ç±2,500</option>
                                <option value="2500+">‚Ç±2,500+</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="apply-user-filter" class="btn btn-primary w-full">Apply Filter</button>
                        </div>
                    </div>
                </div>

                <!-- Vehicle Listings -->
                <div id="user-vehicle-listings" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Vehicle cards will be populated here -->
                </div>
            </div>

            <!-- My Bookings Section -->
            <div id="bookings-section" class="section hidden">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">My Bookings</h1>
                
                <!-- Booking Filters -->
                <div class="card mb-6">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Current Bookings</h3>
                        <select id="booking-filter" class="form-input">
                            <option value="all">All Bookings</option>
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="active">Active</option>
                        </select>
                    </div>
                </div>

                <div id="current-bookings-list" class="space-y-4">
                    <!-- Current bookings will be populated here -->
                </div>
            </div>

            <!-- Booking History Section -->
            <div id="history-section" class="section hidden">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Booking History</h1>
                
                <div class="card">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4">Booking ID</th>
                                    <th class="text-left py-3 px-4">Vehicle</th>
                                    <th class="text-left py-3 px-4">Dates</th>
                                    <th class="text-left py-3 px-4">Status</th>
                                    <th class="text-left py-3 px-4">Total</th>
                                    <th class="text-left py-3 px-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="booking-history-table">
                                <!-- Booking history will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profile-section" class="section hidden">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">My Profile</h1>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card">
                        <h2 class="text-xl font-semibold mb-4">Personal Information</h2>
                        <form id="profile-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="form-label">First Name</label>
                                    <input type="text" name="firstName" id="profile-first-name" class="form-input" required>
                                </div>
                                <div>
                                    <label class="form-label">Last Name</label>
                                    <input type="text" name="lastName" id="profile-last-name" class="form-input" required>
                                </div>
                            </div>
                            <div>
                                <label class="form-label">Email Address</label>
                                <input type="email" name="email" id="profile-email" class="form-input" required>
                            </div>
                            <div>
                                <label class="form-label">Phone Number</label>
                                <input type="tel" name="phone" id="profile-phone" class="form-input" required>
                            </div>
                            <div>
                                <label class="form-label">Address</label>
                                <textarea name="address" id="profile-address" class="form-input" rows="3"></textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="form-label">City</label>
                                    <input type="text" name="city" id="profile-city" class="form-input">
                                </div>
                                <div>
                                    <label class="form-label">Zip Code</label>
                                    <input type="text" name="zipCode" id="profile-zip" class="form-input">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Profile</button>
                        </form>
                    </div>
                    
                    <div class="card">
                        <h2 class="text-xl font-semibold mb-4">Change Password</h2>
                        <form id="password-form" class="space-y-4">
                            <div>
                                <label class="form-label">Current Password</label>
                                <input type="password" name="currentPassword" class="form-input" required>
                            </div>
                            <div>
                                <label class="form-label">New Password</label>
                                <input type="password" name="newPassword" class="form-input" required>
                            </div>
                            <div>
                                <label class="form-label">Confirm New Password</label>
                                <input type="password" name="confirmPassword" class="form-input" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Change Password</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports-section" class="section hidden">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Transaction Reports</h1>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card">
                        <h2 class="text-xl font-semibold mb-4">Generate Report</h2>
                        <form id="user-report-form" class="space-y-4">
                            <div>
                                <label class="form-label">Report Period</label>
                                <select name="period" class="form-input">
                                    <option value="last-month">Last Month</option>
                                    <option value="last-quarter">Last Quarter</option>
                                    <option value="last-year">Last Year</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Report Type</label>
                                <select name="reportType" class="form-input">
                                    <option value="transactions">Transaction History</option>
                                    <option value="bookings">Booking Summary</option>
                                    <option value="expenses">Expense Report</option>
                                </select>
                            </div>
                            <div class="flex space-x-2">
                                <button type="button" onclick="userDashboard.generateTransactionReport()" class="btn btn-primary flex-1">
                                    üìÑ Generate PDF
                                </button>
                                <button type="button" onclick="userDashboard.printTransactions()" class="btn btn-secondary flex-1">
                                    üñ®Ô∏è Print
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="card">
                        <h2 class="text-xl font-semibold mb-4">Report a Dispute</h2>
                        <form id="dispute-form" class="space-y-4">
                            <div>
                                <label class="form-label">Booking ID</label>
                                <select name="bookingId" class="form-input" required>
                                    <option value="">Select a booking</option>
                                    <!-- Booking options will be populated -->
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Issue Type</label>
                                <select name="issueType" class="form-input" required>
                                    <option value="">Select issue type</option>
                                    <option value="vehicle-condition">Vehicle Condition</option>
                                    <option value="billing">Billing Issue</option>
                                    <option value="service">Service Quality</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Description</label>
                                <textarea name="description" class="form-input" rows="4" required placeholder="Please describe the issue in detail..."></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit Dispute</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Details Modal -->
    <div id="booking-details-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Booking Details</h2>
                <button id="close-booking-details" class="text-gray-500 hover:text-gray-700 text-3xl">&times;</button>
            </div>
            <div id="booking-details-content">
                <!-- Booking details will be populated here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../../config/app.config.js"></script>
    <script src="../../components/auth/auth.js"></script>
    <script src="../../components/vehicle/vehicle.js"></script>
    <script src="../../components/booking/booking.js"></script>
    
    <script>
        // User Dashboard Implementation
        class UserDashboard {
            constructor() {
                this.currentSection = 'dashboard';
                this.userBookings = [];
                this.init();
            }

            init() {
                this.checkAuthentication();
                this.bindEvents();
                this.showSection('dashboard');
                this.loadUserData();
                this.initializeDatePickers();
            }

            checkAuthentication() {
                if (!AuthManager.isAuthenticated()) {
                    window.location.href = '../../index.html';
                    return;
                }
                
                const user = AuthManager.getCurrentUser();
                if (user) {
                    document.getElementById('user-welcome').textContent = `Welcome, ${user.name}!`;
                    this.populateProfileForm(user);
                }
            }

            bindEvents() {
                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = e.currentTarget.getAttribute('href').substring(1);
                        this.showSection(section);
                    });
                });

                // Logout
                document.getElementById('logout-btn').addEventListener('click', () => {
                    AuthManager.logout();
                });

                // Profile form
                document.getElementById('profile-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateProfile(e.target);
                });

                // Password form
                document.getElementById('password-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.changePassword(e.target);
                });

                // Filter vehicles
                document.getElementById('apply-user-filter').addEventListener('click', () => {
                    this.applyVehicleFilters();
                });

                // Dispute form
                document.getElementById('dispute-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitDispute(e.target);
                });

                // Close modal
                document.getElementById('close-booking-details').addEventListener('click', () => {
                    document.getElementById('booking-details-modal').classList.add('hidden');
                });
            }

            showSection(sectionName) {
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.add('hidden');
                });

                // Update navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('bg-blue-50', 'text-blue-600', 'font-medium');
                    item.classList.add('text-gray-600');
                });

                // Show selected section
                const targetSection = document.getElementById(`${sectionName}-section`);
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                }

                // Update navigation active state
                const activeNav = document.querySelector(`[href="#${sectionName}"]`);
                if (activeNav) {
                    activeNav.classList.remove('text-gray-600');
                    activeNav.classList.add('bg-blue-50', 'text-blue-600', 'font-medium');
                }

                this.currentSection = sectionName;
                this.loadSectionData(sectionName);
            }

            loadSectionData(sectionName) {
                switch (sectionName) {
                    case 'search':
                        this.loadVehicleSearch();
                        break;
                    case 'bookings':
                        this.loadCurrentBookings();
                        break;
                    case 'history':
                        this.loadBookingHistory();
                        break;
                }
            }

            loadUserData() {
                this.loadDashboardStats();
                this.loadRecentBookings();
                this.loadDisputeBookings();
            }

            loadDashboardStats() {
                // Mock user statistics
                document.getElementById('total-bookings').textContent = '12';
                document.getElementById('active-bookings').textContent = '2';
                document.getElementById('total-spent').textContent = '‚Ç±45,600';
            }

            loadRecentBookings() {
                const recentBookings = [
                    {
                        id: 'BK001',
                        vehicle: 'Toyota Vios',
                        dates: 'Jun 21 - Jun 23, 2025',
                        status: 'confirmed',
                        total: '‚Ç±4,500'
                    },
                    {
                        id: 'BK002',
                        vehicle: 'Honda CRV',
                        dates: 'Jun 15 - Jun 17, 2025',
                        status: 'completed',
                        total: '‚Ç±7,500'
                    }
                ];

                const container = document.getElementById('recent-bookings');
                if (!container) return;

                container.innerHTML = recentBookings.map(booking => `
                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                        <div>
                            <h3 class="font-semibold">${booking.vehicle}</h3>
                            <p class="text-sm text-gray-600">${booking.dates}</p>
                            <span class="inline-block px-2 py-1 text-xs rounded ${
                                booking.status === 'confirmed' ? 'bg-green-100 text-green-800' : 
                                booking.status === 'completed' ? 'bg-blue-100 text-blue-800' : 
                                'bg-yellow-100 text-yellow-800'
                            }">${booking.status}</span>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold">${booking.total}</p>
                            <button onclick="userDashboard.viewBookingDetails('${booking.id}')" class="text-blue-600 hover:underline text-sm">
                                View Details
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            loadVehicleSearch() {
                if (window.VehicleManager) {
                    VehicleManager.loadVehicles().then(() => {
                        this.renderUserVehicles(VehicleManager.vehicles);
                    });
                }
            }

            renderUserVehicles(vehicles) {
                const container = document.getElementById('user-vehicle-listings');
                if (!container) return;

                if (vehicles.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <p class="text-gray-500">No vehicles found matching your criteria.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = vehicles.map(vehicle => `
                    <div class="card">
                        <img src="${vehicle.image}" alt="${vehicle.name}" class="w-full h-48 object-cover rounded-lg mb-4">
                        <h3 class="font-semibold text-lg mb-2">${vehicle.name}</h3>
                        <p class="text-gray-600 text-sm mb-2">${vehicle.type} ‚Ä¢ ${vehicle.fuelType}</p>
                        <p class="text-gray-600 text-sm mb-4">Seats: ${vehicle.capacity} ‚Ä¢ ${vehicle.drivingOption}</p>
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-2xl font-bold text-blue-600">‚Ç±${vehicle.pricePerDay}</span>
                            <span class="text-gray-500 text-sm">/day</span>
                        </div>
                        <button onclick="vehicleManager.bookVehicle('${vehicle.id}')" class="btn btn-primary w-full">
                            Book Now
                        </button>
                    </div>
                `).join('');
            }

            applyVehicleFilters() {
                const filters = {
                    brand: document.getElementById('user-brand-filter').value,
                    type: document.getElementById('user-type-filter').value,
                    fuelType: document.getElementById('user-fuel-filter').value,
                    capacity: document.getElementById('user-capacity-filter').value,
                    pickupDate: document.getElementById('user-pickup-date').value,
                    returnDate: document.getElementById('user-return-date').value
                };

                if (window.VehicleManager) {
                    VehicleManager.applyFilters(filters);
                    this.renderUserVehicles(VehicleManager.filteredVehicles);
                }
            }

            loadCurrentBookings() {
                // Mock current bookings
                const bookings = [
                    {
                        id: 'BK001',
                        vehicle: 'Toyota Vios',
                        dates: 'Jun 21 - Jun 23, 2025',
                        status: 'confirmed',
                        total: '‚Ç±4,500',
                        canCancel: true
                    }
                ];

                const container = document.getElementById('current-bookings-list');
                if (!container) return;

                container.innerHTML = bookings.map(booking => `
                    <div class="card">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-semibold text-lg">${booking.vehicle}</h3>
                                <p class="text-gray-600">${booking.dates}</p>
                                <span class="inline-block px-2 py-1 text-xs rounded ${
                                    booking.status === 'confirmed' ? 'bg-green-100 text-green-800' : 
                                    'bg-yellow-100 text-yellow-800'
                                }">${booking.status}</span>
                            </div>
                            <div class="text-right">
                                <p class="font-semibold text-lg">${booking.total}</p>
                                <div class="space-x-2 mt-2">
                                    <button onclick="userDashboard.viewBookingDetails('${booking.id}')" class="text-blue-600 hover:underline text-sm">
                                        View
                                    </button>
                                    ${booking.canCancel ? `
                                        <button onclick="userDashboard.cancelBooking('${booking.id}')" class="text-red-600 hover:underline text-sm">
                                            Cancel
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            loadBookingHistory() {
                // Mock booking history
                const history = [
                    {
                        id: 'BK002',
                        vehicle: 'Honda CRV',
                        dates: 'Jun 15 - Jun 17, 2025',
                        status: 'completed',
                        total: '‚Ç±7,500'
                    }
                ];

                const tbody = document.getElementById('booking-history-table');
                if (!tbody) return;

                tbody.innerHTML = history.map(booking => `
                    <tr class="border-b border-gray-100">
                        <td class="py-3 px-4">${booking.id}</td>
                        <td class="py-3 px-4">${booking.vehicle}</td>
                        <td class="py-3 px-4">${booking.dates}</td>
                        <td class="py-3 px-4">
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">${booking.status}</span>
                        </td>
                        <td class="py-3 px-4">${booking.total}</td>
                        <td class="py-3 px-4">
                            <button onclick="userDashboard.viewBookingDetails('${booking.id}')" class="text-blue-600 hover:underline text-sm">
                                View
                            </button>
                        </td>
                    </tr>
                `).join('');
            }

            loadDisputeBookings() {
                // Populate dispute form with user's bookings
                const bookingSelect = document.querySelector('#dispute-form select[name="bookingId"]');
                if (bookingSelect) {
                    bookingSelect.innerHTML = `
                        <option value="">Select a booking</option>
                        <option value="BK001">BK001 - Toyota Vios</option>
                        <option value="BK002">BK002 - Honda CRV</option>
                    `;
                }
            }

            populateProfileForm(user) {
                const fields = ['firstName', 'lastName', 'email', 'phone', 'address', 'city', 'zipCode'];
                fields.forEach(field => {
                    const input = document.getElementById(`profile-${field.replace(/([A-Z])/g, '-$1').toLowerCase()}`);
                    if (input && user[field]) {
                        input.value = user[field];
                    }
                });
            }

            async updateProfile(form) {
                const formData = new FormData(form);
                const profileData = {
                    firstName: formData.get('firstName'),
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    address: formData.get('address'),
                    city: formData.get('city'),
                    zipCode: formData.get('zipCode')
                };

                const result = await AuthManager.updateProfile(profileData);
                
                if (result.success) {
                    alert('Profile updated successfully!');
                } else {
                    alert('Failed to update profile: ' + result.message);
                }
            }

            async changePassword(form) {
                const formData = new FormData(form);
                const currentPassword = formData.get('currentPassword');
                const newPassword = formData.get('newPassword');
                const confirmPassword = formData.get('confirmPassword');

                if (newPassword !== confirmPassword) {
                    alert('New passwords do not match');
                    return;
                }

                const result = await AuthManager.changePassword(currentPassword, newPassword);
                
                if (result.success) {
                    alert('Password changed successfully!');
                    form.reset();
                } else {
                    alert('Failed to change password: ' + result.message);
                }
            }

            submitDispute(form) {
                const formData = new FormData(form);
                const disputeData = {
                    bookingId: formData.get('bookingId'),
                    issueType: formData.get('issueType'),
                    description: formData.get('description')
                };

                // Mock submission
                alert('Dispute submitted successfully. We will review your case and get back to you within 24 hours.');
                form.reset();
            }

            viewBookingDetails(bookingId) {
                // Mock booking details
                const bookingDetails = {
                    id: bookingId,
                    vehicle: 'Toyota Vios',
                    dates: 'Jun 21 - Jun 23, 2025',
                    status: 'confirmed',
                    total: '‚Ç±4,500',
                    pickupLocation: 'Metro Manila Branch',
                    returnLocation: 'Metro Manila Branch'
                };

                const content = document.getElementById('booking-details-content');
                content.innerHTML = `
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-600">Booking ID</label>
                                <p class="font-semibold">${bookingDetails.id}</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-600">Status</label>
                                <p class="font-semibold">${bookingDetails.status}</p>
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-600">Vehicle</label>
                            <p class="font-semibold">${bookingDetails.vehicle}</p>
                        </div>
                        <div>
                            <label class="text-sm text-gray-600">Rental Period</label>
                            <p class="font-semibold">${bookingDetails.dates}</p>
                        </div>
                        <div>
                            <label class="text-sm text-gray-600">Total Amount</label>
                            <p class="font-semibold text-lg text-blue-600">${bookingDetails.total}</p>
                        </div>
                    </div>
                `;

                document.getElementById('booking-details-modal').classList.remove('hidden');
            }

            cancelBooking(bookingId) {
                if (confirm('Are you sure you want to cancel this booking?')) {
                    // Mock cancellation
                    alert('Booking cancelled successfully. Refund will be processed within 3-5 business days.');
                    this.loadCurrentBookings();
                }
            }

            generateTransactionReport() {
                // Generate a simple transaction report
                const reportContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>CarGo Transaction Report</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .header { text-align: center; margin-bottom: 30px; }
                            table { width: 100%; border-collapse: collapse; }
                            th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
                            th { background-color: #f4f4f4; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>CarGo Transaction Report</h1>
                            <p>Generated on: ${new Date().toLocaleDateString()}</p>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Booking ID</th>
                                    <th>Vehicle</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2025-06-15</td>
                                    <td>BK002</td>
                                    <td>Honda CRV</td>
                                    <td>‚Ç±7,500</td>
                                    <td>Completed</td>
                                </tr>
                                <tr>
                                    <td>2025-06-21</td>
                                    <td>BK001</td>
                                    <td>Toyota Vios</td>
                                    <td>‚Ç±4,500</td>
                                    <td>Confirmed</td>
                                </tr>
                            </tbody>
                        </table>
                    </body>
                    </html>
                `;

                const blob = new Blob([reportContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cargo-transactions-${new Date().toISOString().split('T')[0]}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            printTransactions() {
                window.print();
            }

            initializeDatePickers() {
                if (typeof flatpickr !== 'undefined') {
                    flatpickr('#user-pickup-date', {
                        dateFormat: "Y-m-d",
                        minDate: "today",
                        onChange: (selectedDates) => {
                            const returnPicker = document.getElementById('user-return-date')._flatpickr;
                            if (returnPicker && selectedDates[0]) {
                                returnPicker.set('minDate', new Date(selectedDates[0]).fp_incr(1));
                            }
                        }
                    });

                    flatpickr('#user-return-date', {
                        dateFormat: "Y-m-d",
                        minDate: new Date().fp_incr(1)
                    });
                }
            }
        }

        // Initialize user dashboard
        const userDashboard = new UserDashboard();
    </script>
</body>
</html>
